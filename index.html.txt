<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Ïñ∏Îçï ÎÑàÎ®∏Ïùò Ïó∞Î™ª</title>
<style>
  body {
    margin: 0;
    background: #1b2b1b;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: monospace;
    color: #e8fff1;
  }
  #container {
    position: relative;
  }
  canvas {
    image-rendering: pixelated;
    border: 4px solid #4a6b3f;
    background: #7fcf9a;
    touch-action: none;
  }
  #touchUI {
    position: absolute;
    bottom: -70px;
    width: 320px;
    display: flex;
    justify-content: space-between;
    pointer-events: auto;
  }
  .btn {
    width: 60px;
    height: 60px;
    background: rgba(74, 107, 63, 0.6);
    border: 2px solid #4a6b3f;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    user-select: none;
  }
  #jumpBtn {
    margin: 0 auto;
  }
  #ui {
    margin-top: 80px;
    text-align: center;
    font-size: 12px;
  }
  input[type=range] {
    width: 200px;
  }
</style>
</head>
<body>

<div id="container">
  <canvas id="game" width="320" height="180"></canvas>

  <!-- üñêÔ∏è ÌÑ∞Ïπò Î≤ÑÌäº -->
  <div id="touchUI">
    <div class="btn" id="leftBtn">‚¨ÖÔ∏è</div>
    <div class="btn" id="jumpBtn">‚¨ÜÔ∏è</div>
    <div class="btn" id="rightBtn">‚û°Ô∏è</div>
  </div>

  <div id="ui">
    üéµ Î≥ºÎ•®
    <input id="volume" type="range" min="0" max="1" step="0.01" value="0.4">
  </div>
</div>

<audio id="bgm" src="bgm.mp3" loop></audio>
<audio id="jumpSound" src="jump.wav"></audio>
<audio id="dewSound" src="dew.wav"></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const bgm = document.getElementById("bgm");
const jumpSound = document.getElementById("jumpSound");
const dewSound = document.getElementById("dewSound");
const volumeSlider = document.getElementById("volume");

// ÏûÖÎ†• ÏÉÅÌÉú
const keys = { left:false, right:false, jump:false };
let audioStarted = false;

// üéµ Ïò§ÎîîÏò§ ÏãúÏûë
function startAudio() {
  if (!audioStarted) {
    bgm.volume = volumeSlider.value;
    bgm.play();
    audioStarted = true;
  }
}

// ÌÇ§Î≥¥Îìú
window.addEventListener("keydown", e => {
  startAudio();
  if (e.key === "ArrowLeft") keys.left = true;
  if (e.key === "ArrowRight") keys.right = true;
  if (e.key === " " || e.key === "ArrowUp") keys.jump = true;
});
window.addEventListener("keyup", e => {
  if (e.key === "ArrowLeft") keys.left = false;
  if (e.key === "ArrowRight") keys.right = false;
  if (e.key === " " || e.key === "ArrowUp") keys.jump = false;
});

// üñêÔ∏è ÌÑ∞Ïπò Î≤ÑÌäº
function bindTouch(id, action) {
  const btn = document.getElementById(id);
  btn.addEventListener("touchstart", e => {
    e.preventDefault();
    startAudio();
    keys[action] = true;
  });
  btn.addEventListener("touchend", e => {
    e.preventDefault();
    keys[action] = false;
  });
}
bindTouch("leftBtn", "left");
bindTouch("rightBtn", "right");
bindTouch("jumpBtn", "jump");

// Î≥ºÎ•®
volumeSlider.addEventListener("input", () => {
  bgm.volume = volumeSlider.value;
  jumpSound.volume = volumeSlider.value;
  dewSound.volume = volumeSlider.value;
});

// üê∏ Í∞úÍµ¨Î¶¨
const frog = {
  x: 40, y: 120, w: 10, h: 10,
  vx: 0, vy: 0,
  onGround: false,
  state: "idle",
  animTimer: 0
};

// ÌîåÎû´Ìèº
const platforms = [
  {x:0,y:150,w:320,h:30},
  {x:70,y:120,w:40,h:6},
  {x:140,y:100,w:40,h:6},
  {x:210,y:80,w:40,h:6}
];

// Ïù¥Ïä¨
const dews = [
  {x:85,y:105,taken:false},
  {x:155,y:85,taken:false},
  {x:225,y:65,taken:false}
];

let dewCount = 0;
let jumpLock = false;

function update() {
  frog.vx = 0;
  if (keys.left) frog.vx = -1.2;
  if (keys.right) frog.vx = 1.2;

  if (keys.jump && frog.onGround && !jumpLock) {
    frog.vy = -4.2;
    frog.onGround = false;
    frog.state = "jump";
    jumpLock = true;
    jumpSound.currentTime = 0;
    jumpSound.play();
  }
  if (!keys.jump) jumpLock = false;

  frog.vy += 0.2;
  frog.x += frog.vx;
  frog.y += frog.vy;

  frog.onGround = false;
  platforms.forEach(p => {
    if (
      frog.x < p.x+p.w &&
      frog.x+frog.w > p.x &&
      frog.y < p.y+p.h &&
      frog.y+frog.h > p.y &&
      frog.vy > 0
    ) {
      frog.y = p.y - frog.h;
      frog.vy = 0;
      frog.onGround = true;
      frog.state = "idle";
    }
  });

  dews.forEach(d => {
    if (!d.taken &&
        frog.x < d.x+6 &&
        frog.x+frog.w > d.x &&
        frog.y < d.y+6 &&
        frog.y+frog.h > d.y) {
      d.taken = true;
      dewCount++;
      dewSound.currentTime = 0;
      dewSound.play();
    }
  });

  frog.animTimer++;
}

function drawFrog() {
  let h = frog.h;
  if (!frog.onGround) h += 3;
  ctx.fillStyle = "#2f7f4f";
  ctx.fillRect(frog.x, frog.y, frog.w, h);
}

function draw() {
  ctx.fillStyle = "#7fcf9a";
  ctx.fillRect(0,0,320,180);

  ctx.fillStyle = "#4a6b3f";
  platforms.forEach(p=>ctx.fillRect(p.x,p.y,p.w,p.h));

  ctx.fillStyle = "#e8fff1";
  dews.forEach(d=>{ if(!d.taken) ctx.fillRect(d.x,d.y,4,4); });

  drawFrog();

  ctx.fillStyle = "#183018";
  ctx.fillText("ÎπõÏùò Ïù¥Ïä¨: "+dewCount, 10, 12);
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>